<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="static/css/smoothness/jquery-ui-1.8.16.custom.css" type="text/css"/>
<link rel="stylesheet" href="static/slick.grid.css" type="text/css"/>
<link rel="stylesheet" href="static/census.css" type="text/css"/>
<style>
.slick-headerrow-column {
    background: #87ceeb;
    text-overflow: clip;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
}

.slick-headerrow-column input {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
}
.selected {
    background: beige;
    -webkit-transition: 0.5s background;
}

</style>
</head>
<body>
<div style="position:relative">
    <div style="width:600px;">
        <div id="myGrid" style="width:100%;height:500px;"></div>
    </div>

</div>

<script src="static/lib/firebugx.js"></script>

<script src="static/lib/jquery-1.7.min.js"></script>
<script src="static/lib/jquery-ui-1.8.16.custom.min.js"></script>
<script src="static/lib/jquery.event.drag-2.2.js"></script>

<script src="static/slick.core.js"></script>
<script src="static/slick.dataview.js"></script>
<script src="static/plugins/slick.cellrangedecorator.js"></script>
<script src="static/plugins/slick.cellrangeselector.js"></script>
<script src="static/plugins/slick.cellexternalcopymanager.js"></script>
<script src="static/plugins/slick.cellselectionmodel.js"></script>
<script src="static/slick.grid.js"></script>

<script>
var dataView;
var grid;
var data = [];
var options = {
enableCellNavigation: true,
                      showHeaderRow: true,
                      headerRowHeight: 30,
                      explicitInitialization: true,
                      multiColumnSort: true
};
var columns = [];
var columnFilters = {};

var columns = [
{ id: "title", name: "Title", field: "title", sortable: true },
{ id: "duration", name: "Duration", field: "duration", sortable: true},
{ id: "%", name: "% Complete", field: "percentComplete", sortable: true },
{ id: "start", name: "Start", field: "start", sortable: true },
{ id: "finish", name: "Finish", field: "finish", sortable: true },
{ id: "effort-driven", name: "Effort Driven", field: "effortDriven", sortable: true }
];

var copyManager = new Slick.CellExternalCopyManager();

function varType( o ) 
{
    if ( o.toFixed )
        return "N";
    if ( o.substring )
        return "C";
    if ( o.getMonth )
        return "D";
    if ( o == true || o == false )
        return "L";
    return "U";
}

function date_num_filter( cVal )
{
    var ret_arr = [];
    var p       = -1;
    var n1,n2,n3

        if ( cVal.length == 0 )
            return ret_arr;

    n1 = cVal.indexOf( ".." );
    n2 = cVal.indexOf( "<" );
    n3 = cVal.indexOf( ">" );
    if ( n1 >= 0 || n2 >= 0 || n3 >= 0 )
    {
        p = cVal.indexOf( ".." );
        if ( p >= 0 && cVal.length > 2 )
        {
            if ( p == 0 || p == cVal.length - 2 )
            {
                ret_arr[ 0 ] = ( p == 0 ? "<=" : ">=" );
                ret_arr[ 1 ] = ( p == 0 ? cVal.substr( 2 ) : cVal.substr( 0, p ) );
            }
            else
            {
                ret_arr[ 0 ] = ">=";
                ret_arr[ 1 ] = cVal.substr( 0, p );
                ret_arr[ 2 ] = "<=";
                ret_arr[ 3 ] = cVal.substr( p + 2 );
            }                  
            return ret_arr;
        }

        n1 = cVal.indexOf( "<=" );
        n2 = cVal.indexOf( ">=" );
        if ( n1 == 0 || n2 == 0 )
        {
            if ( cVal.length > 2 );
            {
                ret_arr[ 0 ] = cVal.substr( 0, 2 );
                ret_arr[ 1 ] = cVal.substr( 2 );
                return ret_arr;
            }
        }   
        n1 = cVal.indexOf( "<" );
        n2 = cVal.indexOf( ">" );
        if ( n1 == 0 || n2 == 0 ) 
        {
            if ( cVal.length > 1 );
            {
                ret_arr[ 0 ] = cVal.substr( 0, 1 );
                ret_arr[ 1 ] = cVal.substr( 1 );
                return ret_arr;
            }   
        }
    }   
    return ret_arr;
}

function filter1( item ) 
{
    for ( var columnId in columnFilters ) 
    {
        if ( columnId !== undefined && columnFilters[ columnId ] !== "" ) 
        {
            var c   = grid.getColumns()[ grid.getColumnIndex( columnId ) ];
            var typ = varType( item[ c.field ] );
            if ( typ == "N" || typ == "D" ) 
            {
                var arr = date_num_filter( columnFilters[ columnId ] )
                    if ( arr.length > 0 )
                    {
                        if ( arr.length == 2 )
                        {
                            switch ( arr[ 0 ] )
                            {
                                case "<" : 
                                    if ( item[ c.field ] >= arr[ 1 ] )
                                        return false;
                                    break;
                                case ">" : 
                                    if ( item[ c.field ] <= arr[ 1 ] )
                                        return false;
                                    break;
                                case "<=" :
                                    if ( item[ c.field ] > arr[ 1 ] )
                                        return false;
                                    break;
                                case ">=" :   
                                    if ( item[ c.field ] < arr[ 1 ] )
                                        return false;
                                    break;
                                default :
                                    return false;                          
                            }
                        }   
                        else
                        {
                            if ( item[ c.field ] < arr[ 1 ] || item[ c.field ] > arr[ 3 ] ) 
                                return false;
                        }
                    }   
                    else
                    {
                        if ( item[ c.field ] != columnFilters[ columnId ] )
                            return false;
                    }      
            }
            if ( typ == "C" ) // item[ c.field ].substring 
            {
                if ( item[ c.field ].toLowerCase().indexOf( columnFilters[ columnId ] ) == -1 ) // item[ c.field ] != columnFilters[ columnId ] && 
                    return false;
            }
        }   
    }
    return true;
}

function filter(item) {
    for (var columnId in columnFilters) {
        if (columnId !== undefined && columnFilters[columnId] !== "") {
            var c = grid.getColumns()[grid.getColumnIndex(columnId)];
            if (item[c.field].indexOf(columnFilters[columnId]) == -1) {
                return false;
            }
        }
    }
    return true;
}

$(function () {
        var data = []; 
        for (var i = 0; i < 500; i++) {
        data[i] = {
id: i,
title: "Task " + i,
duration: "5 days",
percentComplete: Math.round(Math.random() * 100),
start: "01/01/2009",
finish: "01/05/2009",
effortDriven: (i % 5 == 0)
};
}

dataView = new Slick.Data.DataView();
grid = new Slick.Grid("#myGrid", dataView, columns, options);

grid.setSelectionModel(new Slick.CellSelectionModel());
grid.registerPlugin(copyManager);

grid.onSort.subscribe(function (e, args) {
    var cols = args.sortCols;
    console.log(cols);
    data.sort(function (dataRow1, dataRow2) {
        for (var i = 0, l = cols.length; i < l; i++) {
        var field = cols[i].sortCol.field;
        var sign = cols[i].sortAsc ? 1 : -1;
        var value1 = dataRow1[field], value2 = dataRow2[field];
        var result = (value1 == value2 ? 0 : (value1 > value2 ? 1 : -1)) * sign;
        console.log(field);
        console.log(result);
        if (result != 0) {
        return result;
        }
        }
        return 0;
        });

    dataView.beginUpdate();
    dataView.setItems(data);
    dataView.endUpdate();
    grid.invalidate();
    grid.render();
});


dataView.onRowCountChanged.subscribe(function (e, args) {
        grid.updateRowCount();
        grid.render();
        });

dataView.onRowsChanged.subscribe(function (e, args) {
        grid.invalidateRows(args.rows);
        grid.render();
        });


$(grid.getHeaderRow()).delegate(":input", "change keyup", function (e) {
        var columnId = $(this).data("columnId");
        if (columnId != null) {
        columnFilters[columnId] = $.trim($(this).val());
        dataView.refresh();
        }
        });

grid.onHeaderRowCellRendered.subscribe(function(e, args) {
        $(args.node).empty();
        $("<input type='text'>")
        .data("columnId", args.column.id)
        .val(columnFilters[args.column.id])
        .appendTo(args.node);
        });

grid.init();

dataView.beginUpdate();
dataView.setItems(data);
dataView.setFilter(filter1);
dataView.endUpdate();
})
</script>
</body>
</html>
